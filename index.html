<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenShift Sizing Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .result-card {
             background-color: #f3f4f6;
             border: 1px solid #e5e7eb;
        }
        .info-box {
            background-color: #eef2ff;
            border-left: 4px solid #6366f1;
            padding: 1rem;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">OpenShift Sizing Calculator</h1>
            <p class="text-gray-600 mt-2">Estimate the required compute and storage nodes for your OpenShift cluster.</p>
        </header>

        <main>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Workload Specification -->
                <div class="card lg:col-span-1">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Workload Specs</h2>
                    <div id="workload-list">
                        <!-- Dynamic workload entries will be injected here -->
                    </div>
                    <button id="add-workload-btn" class="mt-4 w-full bg-indigo-100 text-indigo-700 font-semibold py-2 px-4 rounded-lg hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        + Add Workload Type
                    </button>
                </div>

                <!-- Server Specification -->
                <div class="card lg:col-span-1">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Worker Node Specs</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="physicalCpuPerServer" class="block text-sm font-medium text-gray-700">Physical CPUs per Node</label>
                            <input type="number" id="physicalCpuPerServer" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., 8">
                        </div>
                         <div>
                            <label for="cpuConversionRatio" class="block text-sm font-medium text-gray-700">CPU to vCPU Ratio</label>
                            <input type="number" id="cpuConversionRatio" value="2" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="memPerServer" class="block text-sm font-medium text-gray-700">Memory per Node (GB)</label>
                            <input type="number" id="memPerServer" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="e.g., 64">
                        </div>
                         <div class="pt-4 border-t">
                            <label class="flex items-center">
                                <input type="checkbox" id="failover-checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-gray-900 font-medium">Add N+1 Failover Node</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Storage Specification -->
                <div class="card lg:col-span-1">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Storage Specs (Optional)</h2>
                    <div class="space-y-4">
                         <div>
                            <label for="totalStorage" class="block text-sm font-medium text-gray-700">Total Storage Required (GB)</label>
                            <input type="number" id="totalStorage" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="totalIops" class="block text-sm font-medium text-gray-700">Total IOPS Required</label>
                            <input type="number" id="totalIops" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                         <div class="pt-4 border-t">
                             <h3 class="text-lg font-medium text-gray-800">Storage Provider</h3>
                             <p class="text-xs text-gray-500 mb-2">Performance of a single storage disk or node.</p>
                             <div class="mt-2">
                                <label for="capacityPerDisk" class="block text-sm font-medium text-gray-700">Capacity per Disk/Node (GB)</label>
                                <input type="number" id="capacityPerDisk" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                             <div class="mt-4">
                                <label for="iopsPerDisk" class="block text-sm font-medium text-gray-700">IOPS per Disk/Node</label>
                                <input type="number" id="iopsPerDisk" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Growth Projection -->
                <div class="card lg:col-span-1">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Growth Projection (Optional)</h2>
                    <div class="space-y-4">
                        <div class="pt-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="growth-checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-gray-900 font-medium">Enable Growth Projection</span>
                            </label>
                        </div>
                        <div id="growth-inputs" class="space-y-4 hidden">
                             <div>
                                <label for="growthPercentage" class="block text-sm font-medium text-gray-700">Annual Growth (%)</label>
                                <input type="number" id="growthPercentage" value="20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="forecastPeriod" class="block text-sm font-medium text-gray-700">Forecast Period (Months)</label>
                                <input type="number" id="forecastPeriod" value="12" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <button id="calculateBtn" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Calculate
                </button>
            </div>

            <!-- Results -->
            <div id="results" class="mt-8 card result-card hidden">
                 <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h2 class="text-2xl font-semibold text-gray-700">Sizing Recommendation</h2>
                    <button id="save-excel-btn" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Save to Excel
                    </button>
                 </div>
                 <div id="workload-summary-details" class="mb-6"></div>
                 <div id="results-content" class="grid md:grid-cols-2 gap-8"></div>
                 <div id="graph-details" class="mt-6"></div>
                 <div id="growth-graph-details" class="mt-6"></div>
                 <div id="overhead-details" class="mt-6"></div>
                 <p id="error" class="text-red-500 mt-4 font-semibold"></p>
            </div>
        </main>
    </div>

    <script>
        const workloadList = document.getElementById('workload-list');
        const addWorkloadBtn = document.getElementById('add-workload-btn');
        let workloadId = 0;
        let cpuChart = null;
        let memChart = null;
        let growthCpuChart = null;
        let growthMemChart = null;
        let excelData = {}; // Global object to store calculation data for Excel export

        function createWorkloadEntry() {
            workloadId++;
            const entryDiv = document.createElement('div');
            entryDiv.className = 'workload-entry border-t pt-4 mt-4 space-y-2';
            entryDiv.innerHTML = `
                <div class="flex justify-between items-center">
                    <input type="text" placeholder="Workload Name (e.g., VMs, Web Pods)" class="workload-name block w-full rounded-md border-gray-300 shadow-sm sm:text-sm font-semibold">
                    <button type="button" class="remove-workload-btn text-red-500 hover:text-red-700 ml-4 font-bold text-xl">&times;</button>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Instances</label>
                        <input type="number" value="0" class="workload-instances mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">vCPU/Inst</label>
                        <input type="number" step="0.1" value="0" class="workload-vcpu mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Mem/Inst</label>
                        <input type="number" step="0.1" value="0" class="workload-mem mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm">
                    </div>
                </div>
            `;
            workloadList.appendChild(entryDiv);
        }
        
        createWorkloadEntry();
        
        addWorkloadBtn.addEventListener('click', createWorkloadEntry);

        workloadList.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-workload-btn')) {
                e.target.closest('.workload-entry').remove();
            }
        });

        document.getElementById('growth-checkbox').addEventListener('change', function() {
            document.getElementById('growth-inputs').classList.toggle('hidden', !this.checked);
        });

        document.getElementById('calculateBtn').addEventListener('click', function() {
            excelData = { inputs: [], results: {} }; // Reset excel data
            let initialWorkloadVcpu = 0;
            let initialWorkloadMem = 0;
            document.querySelectorAll('.workload-entry').forEach(entry => {
                const name = entry.querySelector('.workload-name').value || 'Unnamed Workload';
                const instances = parseInt(entry.querySelector('.workload-instances').value) || 0;
                const vcpu = parseFloat(entry.querySelector('.workload-vcpu').value) || 0;
                const mem = parseFloat(entry.querySelector('.workload-mem').value) || 0;
                initialWorkloadVcpu += instances * vcpu;
                initialWorkloadMem += instances * mem;
                excelData.inputs.push({ Type: 'Workload', Name: name, Instances: instances, 'vCPU/Instance': vcpu, 'Memory/Instance (GB)': mem });
            });
            
            const physicalCpuPerServer = parseInt(document.getElementById('physicalCpuPerServer').value) || 0;
            const cpuConversionRatio = parseFloat(document.getElementById('cpuConversionRatio').value) || 1;
            const memPerServer = parseInt(document.getElementById('memPerServer').value) || 0;
            const addFailoverNode = document.getElementById('failover-checkbox').checked;
            const enableGrowth = document.getElementById('growth-checkbox').checked;
            
            const growthPercentage = parseInt(document.getElementById('growthPercentage').value) || 0;
            const forecastPeriod = parseInt(document.getElementById('forecastPeriod').value) || 0;

            const totalStorage = parseInt(document.getElementById('totalStorage').value) || 0;
            const totalIops = parseInt(document.getElementById('totalIops').value) || 0;
            const capacityPerDisk = parseInt(document.getElementById('capacityPerDisk').value) || 0;
            const iopsPerDisk = parseInt(document.getElementById('iopsPerDisk').value) || 0;
            
            excelData.inputs.push({Type: 'Worker Node', Name: 'Physical CPUs', Value: physicalCpuPerServer});
            excelData.inputs.push({Type: 'Worker Node', Name: 'CPU to vCPU Ratio', Value: cpuConversionRatio});
            excelData.inputs.push({Type: 'Worker Node', Name: 'Memory (GB)', Value: memPerServer});
            excelData.inputs.push({Type: 'Worker Node', Name: 'N+1 Failover', Value: addFailoverNode ? 'Yes' : 'No'});
            excelData.inputs.push({Type: 'Storage', Name: 'Total Storage (GB)', Value: totalStorage});
            excelData.inputs.push({Type: 'Storage', Name: 'Total IOPS', Value: totalIops});
            excelData.inputs.push({Type: 'Storage Provider', Name: 'Capacity/Disk (GB)', Value: capacityPerDisk});
            excelData.inputs.push({Type: 'Storage Provider', Name: 'IOPS/Disk', Value: iopsPerDisk});
            excelData.inputs.push({Type: 'Growth', Name: 'Enabled', Value: enableGrowth ? 'Yes' : 'No'});
            if(enableGrowth) {
                excelData.inputs.push({Type: 'Growth', Name: 'Annual Growth %', Value: growthPercentage});
                excelData.inputs.push({Type: 'Growth', Name: 'Forecast Period (Months)', Value: forecastPeriod});
            }


            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            const workloadSummaryDiv = document.getElementById('workload-summary-details');
            const graphDetailsDiv = document.getElementById('graph-details');
            const growthGraphDetailsDiv = document.getElementById('growth-graph-details');
            const overheadDetailsDiv = document.getElementById('overhead-details');
            const errorDiv = document.getElementById('error');
            
            resultsContent.innerHTML = '';
            workloadSummaryDiv.innerHTML = '';
            graphDetailsDiv.innerHTML = '';
            growthGraphDetailsDiv.innerHTML = '';
            overheadDetailsDiv.innerHTML = '';
            errorDiv.textContent = '';
            resultsDiv.classList.add('hidden');

             if (physicalCpuPerServer <= 0 || memPerServer <= 0 || cpuConversionRatio <= 0) {
                errorDiv.textContent = 'Physical CPUs, Memory, and CPU Ratio must be greater than 0.';
                resultsDiv.classList.remove('hidden');
                return;
            }

            // --- Growth Calculation ---
            let finalWorkloadVcpu = initialWorkloadVcpu;
            let finalWorkloadMem = initialWorkloadMem;
            let monthlyGrowthRate = 0;

            if (enableGrowth && forecastPeriod > 0 && growthPercentage > 0) {
                monthlyGrowthRate = (growthPercentage / 100) / 12;
                finalWorkloadVcpu = initialWorkloadVcpu * Math.pow(1 + monthlyGrowthRate, forecastPeriod);
                finalWorkloadMem = initialWorkloadMem * Math.pow(1 + monthlyGrowthRate, forecastPeriod);
            }

            const totalAvailableVcpu = physicalCpuPerServer * cpuConversionRatio;

            workloadSummaryDiv.innerHTML = `
                <div class="bg-white p-4 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Total Aggregated Workload</h3>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <p class="text-sm text-gray-500">Current vCPU Required</p>
                            <p class="text-xl font-bold text-indigo-600">${initialWorkloadVcpu.toFixed(2)}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Current Memory Required</p>
                            <p class="text-xl font-bold text-indigo-600">${initialWorkloadMem.toFixed(2)} <span class="text-base font-medium">GB</span></p>
                        </div>
                         ${enableGrowth ? `
                        <div>
                            <p class="text-sm text-gray-500">Projected vCPU (${forecastPeriod} Mo)</p>
                            <p class="text-xl font-bold text-purple-600">${finalWorkloadVcpu.toFixed(2)}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Projected Memory (${forecastPeriod} Mo)</p>
                            <p class="text-xl font-bold text-purple-600">${finalWorkloadMem.toFixed(2)} <span class="text-base font-medium">GB</span></p>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            function calculateOverhead(vcpu, mem) {
                let reservedVcpu = (vcpu <= 2) ? 0.5 : (vcpu <= 4) ? 1 : (vcpu <= 8) ? 1.5 : (vcpu <= 16) ? 2 : 2.5;
                let reservedMem = (mem <= 4) ? 1 : (mem <= 8) ? 1.5 : (mem <= 16) ? 2.5 : (mem <= 32) ? 3.5 : (mem <= 64) ? 4.5 : 6;
                return { reservedVcpu, reservedMem };
            }
            const { reservedVcpu: reservedVcpuPerNode, reservedMem: reservedMemPerNode } = calculateOverhead(totalAvailableVcpu, memPerServer);

            const masterNodes = 3;
            const vcpuPerMaster = 4;
            const memPerMaster = 16;

            const usableVcpuPerServer = totalAvailableVcpu - reservedVcpuPerNode;
            const usableMemPerServer = memPerServer - reservedMemPerNode;

            if (usableVcpuPerServer <= 0 || usableMemPerServer <= 0) {
                 errorDiv.textContent = 'Worker Node specification is too low for the calculated overhead.';
                 resultsDiv.classList.remove('hidden');
                 return;
            }
            const workerNodesByCpu = Math.ceil(finalWorkloadVcpu / usableVcpuPerServer);
            const workerNodesByMem = Math.ceil(finalWorkloadMem / usableMemPerServer);
            let workerNodes = Math.max(2, workerNodesByCpu, workerNodesByMem);
            
            if (addFailoverNode) {
                workerNodes += 1;
            }
            
            let requiredStorageUnits = 0;
            const calculateStorage = totalStorage > 0 || totalIops > 0;

            if (calculateStorage) {
                if (iopsPerDisk <= 0 || capacityPerDisk <=0) {
                     errorDiv.textContent = 'To calculate storage, provider IOPS and Capacity must be greater than zero.';
                     resultsDiv.classList.remove('hidden');
                     return;
                }
                const storageNodesByIops = Math.ceil(totalIops / iopsPerDisk);
                const storageNodesByCapacity = Math.ceil(totalStorage / capacityPerDisk);
                requiredStorageUnits = Math.max(3, storageNodesByIops, storageNodesByCapacity);
            }
            
            // Store results for excel
            excelData.results = {
                'Control Plane Nodes': masterNodes,
                'Worker Nodes': workerNodes,
                'Storage Units': calculateStorage ? requiredStorageUnits : 'N/A',
                'Initial vCPU Workload': initialWorkloadVcpu.toFixed(2),
                'Initial Memory Workload (GB)': initialWorkloadMem.toFixed(2),
                'Projected vCPU Workload': enableGrowth ? finalWorkloadVcpu.toFixed(2) : 'N/A',
                'Projected Memory Workload (GB)': enableGrowth ? finalWorkloadMem.toFixed(2) : 'N/A',
                'vCPU per Worker (Total)': totalAvailableVcpu.toFixed(2),
                'Memory per Worker (Total GB)': memPerServer.toFixed(2),
                'vCPU per Worker (Usable)': usableVcpuPerServer.toFixed(2),
                'Memory per Worker (Usable GB)': usableMemPerServer.toFixed(2),
            };


            const failoverText = addFailoverNode ? `<span class="text-xs font-medium text-green-700">(N+1 Redundancy)</span>` : '';
            let resultsHTML = `
                <div>
                    <h3 class="text-lg font-medium text-gray-900">Control Plane</h3>
                    <div class="mt-2 text-gray-600">
                        <p class="text-2xl font-bold text-indigo-600">${masterNodes} <span class="text-lg font-medium text-gray-800">nodes</span></p>
                        <p class="mt-2 text-sm">${vcpuPerMaster} vCPU & ${memPerMaster} GB Memory per node</p>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-medium text-gray-900">Worker Nodes</h3>
                     <div class="mt-2 text-gray-600">
                        <p class="text-2xl font-bold text-indigo-600">${workerNodes} <span class="text-lg font-medium text-gray-800">nodes</span> ${failoverText}</p>
                        <p class="mt-2 text-sm">To support the ${enableGrowth ? 'projected' : 'current'} workload</p>
                    </div>
                </div>
            `;
            
            if(calculateStorage) {
                resultsHTML += `
                 <div>
                    <h3 class="text-lg font-medium text-gray-900">Storage</h3>
                     <div class="mt-2 text-gray-600">
                        <p class="text-2xl font-bold text-indigo-600">${requiredStorageUnits} <span class="text-lg font-medium text-gray-800">units</span></p>
                        <p class="mt-2 text-sm">For ${totalStorage} GB & ${totalIops} IOPS</p>
                    </div>
                </div>`;
            }
            
            resultsContent.className = calculateStorage ? 'grid lg:grid-cols-3 md:grid-cols-2 gap-8' : 'grid md:grid-cols-2 gap-8';
            resultsContent.innerHTML = resultsHTML;

            overheadDetailsDiv.innerHTML = `
                <div class="info-box">
                    <h4 class="font-semibold text-gray-800">Worker Node Breakdown:</h4>
                    <ul class="list-disc list-inside text-sm text-gray-600 mt-2 space-y-1">
                        <li>Total resources: <span class="font-semibold">${physicalCpuPerServer} Physical CPUs (${totalAvailableVcpu.toFixed(1)} vCPU)</span> & <span class="font-semibold">${memPerServer} GB</span> per node</li>
                        <li>Calculated overhead: <span class="font-semibold">${reservedVcpuPerNode.toFixed(2)} vCPU</span> & <span class="font-semibold">${reservedMemPerNode.toFixed(2)} GB</span> per node</li>
                        <li class="font-medium">Usable resources: <span class="font-semibold">${usableVcpuPerServer.toFixed(2)} vCPU</span> & <span class="font-semibold">${usableMemPerServer.toFixed(2)} GB</span> per node</li>
                    </ul>
                </div>`;
            
            // --- Capacity Graph Generation ---
            graphDetailsDiv.innerHTML = `
                 <div class="bg-white p-4 rounded-lg shadow-sm border mt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Capacity Breakdown</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div><canvas id="cpuChart"></canvas></div>
                        <div><canvas id="memChart"></canvas></div>
                    </div>
                 </div>`;
            
            if(cpuChart) cpuChart.destroy();
            if(memChart) memChart.destroy();

            const totalRecommendedVcpu = workerNodes * usableVcpuPerServer;
            const totalRecommendedMem = workerNodes * usableMemPerServer;
            
            const cpuChartData = {
                labels: ['vCPU'],
                datasets: [
                    { label: 'Current Required', data: [initialWorkloadVcpu], backgroundColor: 'rgba(255, 99, 132, 0.5)' },
                    { label: 'Recommended Capacity', data: [totalRecommendedVcpu], backgroundColor: 'rgba(54, 162, 235, 0.5)' }
                ]
            };
            if(enableGrowth) {
                 cpuChartData.datasets.splice(1, 0, { label: `Projected Required`, data: [finalWorkloadVcpu], backgroundColor: 'rgba(153, 102, 255, 0.5)' });
            }
            cpuChart = new Chart(document.getElementById('cpuChart').getContext('2d'), { type: 'bar', data: cpuChartData, options: {plugins: { title: { display: true, text: 'CPU: Required vs. Capacity' }}, scales: { y: { beginAtZero: true } } } });

            const memChartData = {
                labels: ['Memory (GB)'],
                datasets: [
                    { label: 'Current Required', data: [initialWorkloadMem], backgroundColor: 'rgba(255, 159, 64, 0.5)' },
                    { label: 'Recommended Capacity', data: [totalRecommendedMem], backgroundColor: 'rgba(75, 192, 192, 0.5)' }
                ]
            };
             if(enableGrowth) {
                 memChartData.datasets.splice(1, 0, { label: `Projected Required`, data: [finalWorkloadMem], backgroundColor: 'rgba(255, 205, 86, 0.5)' });
            }
            memChart = new Chart(document.getElementById('memChart').getContext('2d'), { type: 'bar', data: memChartData, options: {plugins: { title: { display: true, text: 'Memory: Required vs. Capacity' }}, scales: { y: { beginAtZero: true } } } });
            
            // --- Growth Graph Generation ---
            if(enableGrowth && forecastPeriod > 0) {
                 growthGraphDetailsDiv.innerHTML = `
                 <div class="bg-white p-4 rounded-lg shadow-sm border mt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Resource Growth Projection</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div><canvas id="growthCpuChart"></canvas></div>
                        <div><canvas id="growthMemChart"></canvas></div>
                    </div>
                 </div>`;

                if(growthCpuChart) growthCpuChart.destroy();
                if(growthMemChart) growthMemChart.destroy();
                
                const labels = Array.from({length: forecastPeriod + 1}, (_, i) => `Month ${i}`);
                const cpuData = [];
                const memData = [];

                for (let i = 0; i <= forecastPeriod; i++) {
                    cpuData.push(initialWorkloadVcpu * Math.pow(1 + monthlyGrowthRate, i));
                    memData.push(initialWorkloadMem * Math.pow(1 + monthlyGrowthRate, i));
                }
                
                growthCpuChart = new Chart(document.getElementById('growthCpuChart').getContext('2d'), { type: 'line', data: { labels, datasets: [{ label: 'Projected vCPU', data: cpuData, borderColor: 'rgba(153, 102, 255, 1)', tension: 0.1, fill: false }] }, options: { plugins: { title: { display: true, text: 'vCPU Growth Over Time' }}, scales: { y: { beginAtZero: true } } }});
                growthMemChart = new Chart(document.getElementById('growthMemChart').getContext('2d'), { type: 'line', data: { labels, datasets: [{ label: 'Projected Memory (GB)', data: memData, borderColor: 'rgba(255, 205, 86, 1)', tension: 0.1, fill: false }] }, options: { plugins: { title: { display: true, text: 'Memory Growth Over Time' }}, scales: { y: { beginAtZero: true } } }});
            }

            resultsDiv.classList.remove('hidden');
        });

        document.getElementById('save-excel-btn').addEventListener('click', function() {
            const wb = XLSX.utils.book_new();
            
            // --- Summary Sheet ---
            const summaryData = [
                ["Category", "Item", "Value"],
                ["Recommendation", "Control Plane Nodes", excelData.results['Control Plane Nodes']],
                ["Recommendation", "Worker Nodes", excelData.results['Worker Nodes']],
                ["Recommendation", "Storage Units", excelData.results['Storage Units']],
                ["Workload", "Initial vCPU Required", excelData.results['Initial vCPU Workload']],
                ["Workload", "Initial Memory Required (GB)", excelData.results['Initial Memory Workload (GB)']],
                ["Workload", "Projected vCPU Required", excelData.results['Projected vCPU Workload']],
                ["Workload", "Projected Memory Required (GB)", excelData.results['Projected Memory Workload (GB)']],
                ["Node Capacity", "Total vCPU per Worker", excelData.results['vCPU per Worker (Total)']],
                ["Node Capacity", "Total Memory per Worker (GB)", excelData.results['Memory per Worker (Total GB)']],
                ["Node Capacity", "Usable vCPU per Worker", excelData.results['vCPU per Worker (Usable)']],
                ["Node Capacity", "Usable Memory per Worker (GB)", excelData.results['Memory per Worker (Usable GB)']],
            ];
            const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, wsSummary, "Sizing Summary");

            // --- Inputs Sheet ---
            const wsInputs = XLSX.utils.json_to_sheet(excelData.inputs);
             XLSX.utils.book_append_sheet(wb, wsInputs, "Input Parameters");


            XLSX.writeFile(wb, "OpenShift_Sizing_Report.xlsx");
        });
    </script>
</body>
</html>
